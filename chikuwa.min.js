/**
 * chikuwa.js
 * Copyright (c) 2011 CyberAgent, Inc.
 * License: MIT (http://www.opensource.org/licenses/mit-license)
 * GitHub: https://github.com/suguru/chikuwa.js
 */(function(a){function f(a){return typeof a=="string"||a instanceof String}function g(a){return typeof a=="function"||a instanceof Function}function h(a){return typeof a=="number"||a instanceof Number}function i(a){return a instanceof Object}function j(a){return a instanceof Array}function k(a){return a===undefined||a===null}function l(a){for(var b in a)return!1;return!0}function m(a){return k(a)?"":a}function n(a){return a.replace(/-([a-z])/g,function(a){return a.toUpperCase().replace("-","")})}function o(a){return a.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()})}function p(a,b){return h(b)&&k(d[a])?b+"px":b}function q(a){var b={};for(var c=0;c<a.length;c++)b[a[c]]=1;return b}function r(a){return a?a.replace(/^\s+|\s+$/g,""):""}function s(a){return tag("span").text(a).inner()}function t(a,b,c){if(!c)return;["-webkit-"+b,"-moz-"+b,"-ms-"+b,"-o-"+b,b].forEach(function(b){a[b]=c})}function v(a){return a._cid||(a._cid=++u)}function w(a,b,c){try{var d=new Event(a);return d.target=b,d}catch(e){var f=b instanceof x?b.get(0):null;return{type:a,target:b,currentTarget:f,custom:!0,source:c,stopPropagation:function(){c&&c.stopPropagation()},preventDefault:function(){c&&c.preventDefault()}}}}function x(a,b){f(a)?this.c=b.querySelectorAll(a):j(a)?this.c=a:this.c=[a]}function y(a){return k(a)?null:a instanceof x?a:new x(a,b)}function A(a){return a in z?z[a]:a}function E(a,b,c){this.count=0,this.loop=b||0,this.interval=a||0,this.delay=c||0,this.timerId=0}function G(a,b){var c=(new Error).stack;if(c){var d=c.split(/\n/),e=d[3];if(e){var f=F.exec(e);if(f){var g=f[1];b.push("("+g+")")}}}b.unshift("["+a+"]"),y.os.ios?console.log(b.join(" ")):console.log.apply(console,b)}function I(){}var b=a.document,c=a.document.documentElement,d={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},e=Array.prototype.slice,u=0,z={added:"DOMNodeInsertedIntoDocument",removed:"DOMNodeRemovedFromDocument"};x.prototype={constructor:x,length:function(){return this.c.length},exist:function(a){var b=this.c;return a>=0&&a<b.length&&(j(b)?!k(b[a]):!k(b.item(a)))},get:function(a){return j(this.c)?this.c[a]:this.c.item(a)},each:function(a){var b=this.c instanceof Array;for(var c=0;c<this.c.length;c++)b?a.call(this.c[c]):a.call(this.c.item(c));return this},find:function(a){var b=[];return this.each(function(){var c=this.querySelectorAll(a),d=c.length;for(var e=0;e<d;e++)b.push(c.item(e))}),y(b)},bound:function(a){var c=this.get(0).getBoundingClientRect(),d=a&&a.screen?0:b.body.scrollLeft,e=a&&a.screen?0:b.body.scrollTop;return{left:Math.floor(c.left+d),right:Math.floor(c.right+d),top:Math.floor(c.top+e),bottom:Math.floor(c.bottom+e),width:Math.floor(c.width),height:Math.floor(c.height)}},width:function(a){return a===undefined?this.bound().width:(typeof a=="number"&&(a+="px"),this.css({width:a}))},height:function(a){return a===undefined?this.bound().height:(typeof a=="number"&&(a+="px"),this.css({height:a}))},position:function(a){if(!a){var b=this.bound();return{x:b.left,y:b.top}}return this.css({left:a.x,top:a.y}),this},css:function(a){var b;if(f(a))return this.get(0).style[n(a)]||getComputedStyle(this.get(0),"").getPropertyValue(a);if(arguments.length===0)return b={},this.get(0).style.cssText.split(";").forEach(function(a){var c=a.match(/\s*(.+)\s*:\s*(.+)\s*/);c&&(b[c[1]]=c[2])}),b;b="";var c=a.reset;delete a.reset;for(var d in a){var e=o(d);b+=e+":"+p(d,a[d])+";"}return this.each(function(){c?this.style.cssText=b:this.style.cssText+=b}),this},hasClass:function(a){if(!this.exist(0))return undefined;var b=!1;return this.each(function(){var c=this.className;return b=(" "+m(c)+" ").indexOf(" "+a+" ")>=0,b}),b},cls:function(a){if(k(a)){var b={};return this.each(function(){y.merge(b,q(this.className.split(/\s+/g)))}),b}var c=[],d=[],e=0;return f(a)?c=[a]:j(a)?c=q(a):y.map(a,function(a,b){b===1?c.push(a):d.push(a)}),this.each(function(){var a=q(this.className.split(/\s+/g));for(e=0;e<c.length;e++){var b=c[e];b&&(a[b]=1)}for(e=0;e<d.length;e++)delete a[d[e]];var f="";y.map(a,function(a){f.length===0?f+=a:f+=" "+a}),this.className=f}),this},on:function(a,b,c){return a=A(a),this.each(function(){function d(a){var c=a.currentTarget,d=b.call(c,a);return d}d._cb=b,d._uc=c,this.addEventListener(a,d,c);var e=this._handlers||(this._handlers={}),f=e[a]||(e[a]=[]);f.indexOf(d)<0?f.push(d):alert(b)}),this},trigger:function(a,b){a=A(a);var c=this,d=w(a,c,b);this.each(function(){if(d.custom){var b=this._handlers;if(b&&a in b){var e=b[a];e.forEach(function(a){return a.call(c,d)})}}else this.dispatchEvent(d)})},once:function(a,b,c){return a=A(a),this.each(function(){var d=this;d.addEventListener(a,function(e){return d.removeEventListener(a,arguments.callee,c),b.call(d,e)},c)}),this},off:function(a,b){return a=A(a),this.each(function(){var c=this._handlers;if(c&&a in c){var d,e=c[a];if(b){for(d=0;d<e.length;d++)if(e[d]._cb===b){this.removeEventListener(a,b,e[d]._uc),e.splice(d,1),e.length===0&&delete c[a];break}}else{for(d=0;d<e.length;d++)this.removeEventListener(a,e[d],e[d]._uc);delete c[a]}}}),this},text:function(a){var b=arguments.length;if(b===0){var c="";return this.each(function(){c+=this.textContent}),c}return b>1&&(a=y.format.apply(y,arguments)),a=a||"",this.each(function(){this.textContent=a})},value:function(a){var b=this.get(0);return a!==null&&a!==undefined?(b&&(b.value=a),this):b?b.value||"":""},checked:function(){var a=this.get(0);return a.checked||!1},parent:function(){var a=this.get(0);return a?y(a.parentNode):null},append:function(a){if(k(a))return this;var b=y(a),c=this.get(0);return c&&b.each(function(){c.appendChild(this)}),this},prepend:function(a){if(k(a))return this;var b=y(a),c=this.get(0);return c&&b.each(function(){c.childNodes.length>0&&c.firstChild?c.insertBefore(this,c.firstChild):c.appendChild(this)}),this},replace:function(a,b){if(k(a))return this;var c=y(a),d=this.get(0),e=b.get(0);return d&&c.each(function(){d.childNodes.length>0&&e&&e.parentNode==d?d.insertBefore(this,e):d.appendChild(this),d.removeChild(e)}),this},remove:function(){return this.each(function(){this.parentNode&&this.parentNode.removeChild(this)}),this},empty:function(){return this.inner("")},html:function(){var a=e.apply(arguments);if(a.length===0){var b="";return this.each(function(){this.outerHTML&&(b+=this.outerHTML)}),b}return this.each(function(){this.outerHTML=a[0]})},inner:function(){var a=e.apply(arguments);if(a.length===0){var b="";return this.each(function(){this.innerHTML&&(b+=this.innerHTML)}),b}return this.each(function(){this.innerHTML=a[0]})},tag:function(a,b){var c=y.tag(a,b);return c._p=this,c},gat:function(){var a=this._p;return delete this._p,a.append(this)},appendText:function(a){return this.append(b.createTextNode(a)),this},exec:function(a){return a.call(this),this},attr:function(a,b){var c=this,d;if(a===undefined&&b===undefined){if(arguments.length===1)return this;d=c.get(0);var e={};if(d&&d.attributes){var g=d.attributes.length;for(var h=0;h<g;h++){var j=d.attributes[h];e[j.name]=j.value}}return e}if(b===undefined&&i(a))for(var l in a)c.attr(l,a[l]);else{if(f(a)&&b===undefined)return d=c.get(0),d.hasAttribute(a)?d.getAttribute(a):undefined;this.each(function(){k(b)?this.removeAttribute(a):a==="cls"?c.cls(b):this.setAttribute(a,b)})}return this},data:function(a,b){var c=this,d;if(arguments.length===0){var e=this.attr(),g={};for(d in e)d.indexOf("data-")===0&&(g[d.substring(5)]=e[d]);return g}if(arguments.length===1){if(f(a))return this.attr("data-"+a);var h={};for(d in a)h["data-"+d]=a[d];this.attr(h)}else this.attr("data-"+a,b);return this},tap:function(a){var c=this;if(a){c.on("tap",function(b){return a.call(this,b)});if(y.os.touch){var d=null;c.on("touchstart",function(a){d=y(this),d.__tap={};var c=a.changedTouches[0];d.__tap.x=c.clientX,d.__tap.y=c.pageY+b.body.scrollTop}).on("touchmove",function(a){var c=a.changedTouches[0];d.__tap.toX=c.clientX,d.__tap.toY=c.pageY+b.body.scrollTop;var e=d.__tap;if(!(Math.abs((e.toX||e.x)-e.x)<=10&&Math.abs((e.toY||e.y)-e.y)<=10))return d.trigger("tapout",a),!1}).on("touchend",function(a){a.preventDefault(),a.stopPropagation();var b=d.bound(),c=a.changedTouches[0],e=c.clientX-b.left,f=c.pageY-b.top,g=d.__tap;e>=0&&Math.abs((g.toX||g.x)-g.x)<=5&&Math.abs((g.toY||g.y)-g.y)<=5&&e<=b.width&&f>=0&&f<=b.height&&!d.attr("disabled")&&d.trigger("tap",a),delete d.__tap,d=null})}else c.click(function(a){y(this).trigger("tap",a)})}else c.trigger("tap");return c},over:function(a){function c(a){y(this).trigger("over",a)}var b=this;return b.on("over",function(b){var c=this;c.__over=!0,a.call(c,b)}),y.os.touch?a?b.on("touchstart",c):c():b.mouseover(c),b},tapout:function(a){var b=this;return b.on("tapout",function(b){var c=this;a.call(c,b)}),b},out:function(a){function c(a){y(this).trigger("out",a)}var b=this;return b.on("out",function(b){var c=this;c.__over&&(delete c.__over,a.call(c,b))}),y.os.touch?a?b.on("touchend",c):c():b.mouseout(c),b},transform:function(a,b){var c={},d=b||{};return t(c,"transform",a||"none"),t(c,"transform-origin",d.origin),this.css(c)},transition:function(a,b){var c=this,d=a||{},e="duration"in d?d.duration:.5,f={};t(f,"transform-style","preserve-3d"),t(f,"transition","all "+e+"s "+(d.ease||"")),c.css(f),typeof a=="function"&&(b=a);var g=function(){b&&b.apply(c)};return g&&(y.os.webkit?c.once("webkitTransitionEnd",g):setTimeout(g,e*1e3)),this},rotate:function(a,b,c){return this.transform("rotate("+a+"deg)",b,c)},translate:function(a,b,c,d){return this.transform("translate("+a+"px,"+b+"px)",c,d)},scale:function(a,b,c){return this.transform("scale("+a+","+a+")",b,c)},visible:function(a){return this.css({visibility:a?"visible":"hidden"})},disable:function(){function b(a){a.stopPropagation(),a.preventDefault()}var a=this;return["touchstart","touchend","touchmove","mouseover","mouseout","mousedown","mouseup","click"].forEach(function(c){a.on(c,b)}),a}},["click","blur","change","error","focus","keydown","keyup","keypress","keyup","load","unload","mousedown","mouseup","mousemove","mouseout","mouseover","resize","scroll","select","submit","touchstart","touchmove","touchend"].forEach(function(a){x.prototype[a]=function(b){return b?this.on(a,b):this.trigger(a),this}}),y.win=y(a),y.doc=y(b),y.root=y(c);var B=navigator.userAgent;y.os={ua:B,touch:"ontouchstart"in document.documentElement,ios:/ip(hone|od|ad)/i.test(B),iphone:/iphone/i.test(B),ipad:/ipad/i.test(B),android:/android/i.test(B),mobile:/android.+mobile|ip(hone|od|ad)/i.test(B),webkit:/webkit/i.test(B)},y.ready=function(a){var c=b.readyState;(c==="complete"||c==="loaded")&&a(),y.doc.once("DOMContentLoaded",function(){y.body=y(b.body),a.call(y.doc)})};var C={},D={};y.image=function(){var a=[],b=e.apply(arguments),c=b.pop(),d=b.length;d===0&&c(),b.forEach(function(b){var e=new Image;C[b]=e,["load","error"].forEach(function(f){e.addEventListener(f,function(){delete C[b],--d===0&&c(f,a)})}),e.src=b,a.push(e)})},y.load=function(){function g(a){var e=document.styleSheets;for(var h=0;h<e.length;h++){var i=e[h];if(i.ownerNode.getAttribute("href")===a){H.info("loaded stylesheet",a),D[a]=1,--c===0&&b&&f();return}}if(++d>200){--c===0&&b&&f();return}setTimeout(function(){g(a)},50)}var a=e.apply(arguments),b=a.pop(),c=a.length,d=0,f=function(){b.apply(this,arguments)};a.forEach(function(a){if(D[a]){--c===0&&b&&f("load");return}var e=null,h=a.indexOf(".js")>=0,i=a.indexOf(".css")>=0;h?(e=tag("script",{type:"text/javascript",src:a}),["load","error"].forEach(function(d){e.on(d,function(){e.off("load").off("error").remove(),d==="load"&&(D[a]=1,H.info("loaded script",a)),--c===0&&b&&f(d)})})):i&&(e=y.tag("link",{rel:"stylesheet",type:"text/css",href:a}),d=0,setTimeout(function(){g(a)},10)),y("head").append(e)})},y.loaded=function(){var a=e.apply(arguments);for(var b=0;b<a.length;b++)if(!D[a[b]])return!1;return!0},y.tag=function(a,c){c=c||{};var d=a.indexOf("#"),e=a.indexOf(".");d>0&&(e>0?c.id=a.substring(d+1,e):c.id=a.substring(d+1));if(e>0){var f=a.substring(e+1).split(".");for(var g=0;g<f.length;g++){var h=f[g];c.cls?c.cls+=" "+h:c.cls=h}}a=d>0?a.substring(0,d):e>0?a.substring(0,e):a;var i=b.createElement(a),j=y(i).attr(c);return j},y.fragment=function(){return y(document.createDocumentFragment())},y.extend=function(a){y.map(a,function(a,b){x.prototype[a]=b})},y.map=function(a,b){if(!a)return;for(var c in a)a.hasOwnProperty(c)&&b.call(a,c,a[c])},y.merge=function(a,b){return b?a?(y.map(b,function(b,c){c!==undefined&&(a[b]=c)}),a):b:a},y.filter=function(a,b){var c=[],d=a.length;for(var e=0;e<d;e++){var f=a[e];b(f)&&c.push(f)}return c},y.viewport=function(){return{window:{width:a.innerWidth,height:a.innerHeight,offset:{x:a.pageXOffset,y:a.pageYOffset}},screen:{width:screen.width,height:screen.height},zoom:screen.width/a.innerWidth}},y.cookie=function(a,b,c){var d;if(arguments.length===1){var e=document.cookie.split(";");for(var f=0;f<e.length;f++){d=e[f];var g=d.indexOf("="),h=r(d.substring(0,g));if(a===h)return r(d.substring(g+1))}return undefined}d=a+"="+escape(b?b:"");var i=null;c?(i=new Date,i.setDate(i.getDate()+c)):b||(i=new Date(0)),i&&(d+="; expires="+i.toUTCString()),document.cookie=d},y.storage=function(a,b){if(arguments.length===1){var c=localStorage.getItem(a);return c?JSON.parse(c):null}return localStorage.removeItem(a),k(b)||localStorage.setItem(a,JSON.stringify(b)),this},y.session=function(a,b){if(arguments.length===1){var c=sessionStorage.getItem(a);return c?JSON.parse(c):null}return sessionStorage.removeItem(a),k(b)||sessionStorage.setItem(a,JSON.stringify(b)),this},y.format=function(){var a=arguments;return a[0]?a[0].replace(/\{(\d+)\}/g,function(){return a[arguments[1]]}):null},y.listenize=function(a){a.prototype.on=function(b,c){H.info("listening",a.name,b);if(i(b))for(var d in b)this.on(d,b[d]);else{this._events||(this._events={});var e=this._events[b];e?e.push(c):this._events[b]=[c]}return this},a.prototype.off=function(b,c){H.info("listening off",a.name,b);var d=this;if(arguments.length===1)delete this._events[b];else if(typeof handler=="function"){var f=this._events[b];if(f){var g=f.indexOf(c);g>=0&&(f.splice(g,1),f.length===0&&delete this._events[b])}}else{var h=e.apply(arguments);h.forEach(function(a){d.off(a)})}return this},a.prototype.trigger=function(){if(!this._events)return;var b=e.apply(arguments),c=b.shift();H.debug("triggering",a.name,c,b);var d=this._events[c];if(d)for(var f=0;f<d.length;f++){var g=d[f].apply(this,b);if(g===!1||g===1)return!1}return!0}},E.prototype={lastTap:null,paused:!1,executedTime:0,pastFromPrev:0,start:function(){var a=this;return a.paused=!1,a.delay>0?a.timerId=setTimeout(function(){a.next()},a.delay):a.next(),a},next:function(){var a=this;if(a.end)return;if(a.paused)return;a.count++,a.executedTime=(new Date).getTime(),a.trigger("timer");if(a.loop>0&&--a.loop===0)return;a.timerId=setTimeout(function(){a.next()},a.interval)},pause:function(){this.paused=!0,this.pastFromPrev=(new Date).getTime()-this.executedTime,clearTimeout(this.timerId)},resume:function(){var a=this;this.paused=!1,this.timerId=setTimeout(function(){a.next()},a.interval-a.pastFromPrev)},stop:function(){var a=this;return a.end=!0,clearTimeout(a.timerId),a}},y.listenize(E),y.timer=function(a,b,c){return new E(a,b,c)},y.now=function(){return(new Date).getTime()},y.makeclass=function(a){function b(){this.init&&this.init.apply(this,arguments)}return a.constructor=b,b.prototype=a,b},y.parseQuery=function(a){if(a===null)return!1;var a=a||location.search;if(!a){var b=location.href,c=b.indexOf("?");a=b.substring(c+1)}a.charAt(0)==="?"&&(a=a.substring(1));var d={},e=a.split("&");for(var f=0;f<e.length;f++){var g=e[f],c=g.indexOf("="),h=[g.substring(0,c),g.substring(c+1)];h.length===2&&(d[decodeURIComponent(h[0])]=decodeURIComponent(h[1]))}return d},y.createQuery=function(a){var b="";for(var c in a)b+=encodeURI(c)+"="+encodeURI(a[c])+"&";return b.slice(0,-1)},y.hideAddressBar=function(){var a=y.os.android?window.outerHeight/window.devicePixelRatio:window.outerHeight;document.height-60<a&&(document.body.style.minHeight=a+60+"px"),setTimeout(function(){window.scrollTo(0,1)},50)},a.addEventListener("orientationchange",y.hideAddressBar),a.$=y,y.isString=f,y.isObject=i,y.isEmptyObject=l,y.isFunction=g,y.isNumber=h,y.isArray=j,y.escapeHtml=s;var F=new RegExp("/([^/]+?:[0-9]+):"),H={debug:function(){G("DEBUG",e.apply(arguments))},info:function(){G("INFO",e.apply(arguments))},warn:function(){G("WARN",e.apply(arguments))},error:function(){G("ERROR",e.apply(arguments))},fatal:function(){G("FATAL",e.apply(arguments))}};y.log=H,y.setLogLevel=function(a){switch(a){case"FATAL":H.error=I;case"ERROR":H.warn=I;case"WARN":H.info=I;case"INFO":H.debug=I;default:}}})(window);